<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRN_X851jFmEcdIYud0o-vyjHfB7WApCK5SDQ&s" />
    <meta property="og:title" content="ì ¬ë¯¸ë‹ˆğŸ‘¦, ë”¥ì‹ì´ğŸ‹ì™€ ëŒ€í™”í•˜ê¸°" />
    <meta
      property="og:description"
      content="ì–´ë”˜ê°€ ì´ìƒí•˜ì§€ë§Œ ì¶©ì„±ìŠ¤ëŸ¬ìš´ ë‹¹ì‹ ì˜ ì‚¬ë‘ìŠ¤ëŸ° ì ¬ë¯¸ë‹ˆì™€ ë”¥ì‹ì´ì™€ ëŒ€í™”í•´ë³´ì„¸ìš”!"
    />
    <meta
      property="og:image"
      content="https://cdn.foodneconomy.com/news/photo/202107/328035_70508_2354.jpg"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì–´ë”˜ê°€ ì´ìƒí•˜ì§€ë§Œ ì¶©ì„±ìŠ¤ëŸ¬ìš´</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        height: 100vh;
        background-color: #f2f2f2;
        margin: 0;
      }

      header {
        width: 100%;
        padding: 15px;
        background-color: #333;
        color: white;
        text-align: center;
      }

      #container {
        width: 90%;
        max-width: 600px;
        margin-top: 20px;
        padding: 10px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
        height: calc(100vh - 160px);
      }

      #controller {
        width: 90%;
        max-width: 600px;
        display: flex;
        flex-direction: column;
        margin-top: 10px;
      }

      #controller textarea {
        height: 80px;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
        font-size: 16px;
        resize: none;
      }

      #controller button {
        padding: 10px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      #controller button:hover {
        background-color: #45a049;
      }

      .message {
        display: flex;
        margin-bottom: 10px;
      }

      .message.user {
        justify-content: flex-end;
      }

      .message.bot {
        justify-content: flex-start;
      }

      .message div {
        background-color: #e1e1e1;
        padding: 10px;
        border-radius: 15px;
        max-width: 70%;
        word-wrap: break-word;
      }

      .message.bot div {
        background-color: #f0f0f0;
        border: 1px solid #ddd;
      }

      .message.user div {
        background-color: #c1e5c1;
        border: 1px solid #b4d0b4;
      }
    </style>
  </head>
  <body>
    <header>
      <button id="resetButton">ì±„íŒ…ë°© ë‚˜ê°€ê¸°</button>
    </header>

    <div id="container"></div>

    <form id="controller">
      <label>
        ì—°ë½ì²˜ :
        <select name="modelOption">
          <option value="1">ë‚´ê°€ ì‚¬ë‘í•˜ëŠ” ì ¬ë¯¸ë‹ˆ</option>
          <option value="2">ë‚´ê°€ ì‚¬ë‘í•˜ëŠ” ë”¥ì‹ì´</option>
        </select>
      </label>
      <textarea
        name="textData"
        placeholder="ì—¬ê¸°ì— ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
      ></textarea>
      <button type="submit">ë³´ë‚´ê¸°</button>
    </form>

    <script>
      const _ = () => {
        const container = document.querySelector("#container");
        const form = document.querySelector("#controller");
        const resetButton = document.querySelector("#resetButton");

        resetButton.addEventListener("click", () => (data.length = 0));

        const data = new Proxy([], {
          set(target, property, value) {
            target[property] = value;
            updateContainer();
            updateStorage(target);
            return true;
          },
        });

        function onMounted() {
          data.push(...(JSON.parse(localStorage.getItem("myData")) ?? []));
        }
        onMounted();

        function updateContainer() {
          container.innerHTML = "";
          for (const d of data) {
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message");
            messageDiv.classList.add(d.sender); // senderëŠ” 'user' ë˜ëŠ” 'bot'ìœ¼ë¡œ ì„¤ì •

            const messageText = document.createElement("div");
            messageText.textContent = d.text;
            messageDiv.appendChild(messageText);

            if (d.reply) {
              const replyBox = document.createElement("div");
              replyBox.textContent = d.reply;
              messageDiv.appendChild(replyBox);
            }

            container.appendChild(messageDiv);
          }
        }

        function updateStorage(target) {
          localStorage.setItem("myData", JSON.stringify(target));
        }

        async function handleForm(event) {
          event.preventDefault();
          const formData = new FormData(form);
          const text = formData.get("textData");
          let reply;

          switch (formData.get("modelOption")) {
            case "1":
              reply = `ë‚´ê°€ ì‚¬ë‘í•˜ëŠ” ì ¬ë¯¸ë‹ˆğŸ‘¦ : ${await makeReply(text)}`;
              break;
            case "2":
              reply = `ë‚´ê°€ ì‚¬ë‘í•˜ëŠ” ë”¥ì‹ì´ğŸ‹ : ${await makeReply2(text)}`;
              break;
            default:
              alert("ë¹„ì •ìƒì ì¸ ì ‘ê·¼!");
              throw new Error("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬!");
          }

          const displayData = {
            id: Date.now(),
            text,
            //reply, //ë‹µë³€
            sender: "user", // ì‚¬ìš©ì ë©”ì‹œì§€
          };
          data.push(displayData);

          // AIì˜ ë‹µë³€ ì¶”ê°€
          const botReply = {
            id: Date.now() + 1,
            text: reply,
            sender: "bot", // ë´‡ì˜ ë©”ì‹œì§€
          };
          data.push(botReply);
        }

        async function makeReply(text) {
          const url = "https://productive-majestic-olivine.glitch.me/1";
          const response = await fetch(url, {
            method: "POST",
            body: JSON.stringify({
              text: `${text}`,
            }),
            headers: {
              "Content-Type": "application/json",
            },
          });
          const json = await response.json();
          return json.reply;
        }

        // DeepSeek API í˜¸ì¶œ í•¨ìˆ˜
        async function makeReply2(content) {
          const url = "https://productive-majestic-olivine.glitch.me/2";
          const response = await fetch(url, {
            method: "POST",
            body: JSON.stringify({
              text: `${content}`,
            }),
            headers: {
              "Content-Type": "application/json",
            },
          });
          const json = await response.json();
          return json.reply;
        }

        form.addEventListener("submit", handleForm);
      };

      window.onload = _;
    </script>
  </body>
</html>
